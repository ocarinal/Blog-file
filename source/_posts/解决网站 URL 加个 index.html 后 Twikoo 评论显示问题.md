---
abbrlink: url
categories: []
date: '2025-05-19T15:21:45.786352+08:00'
tags: []
title: 解决网站 URL 加个 index.html 后 Twikoo 评论显示问题
updated: '2025-05-19T15:24:43.268+08:00'
---
<article class="post-content" id="article-container" itemscope="" itemtype="https://blog.xiowo.net/posts/81160ed8/"><header><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" data-pjax-state="">笔记</a><pangu> </pangu><a href="/tags/hexo/" tabindex="-1" itemprop="url" data-pjax-state="">hexo</a><a href="/tags/Twikoo/" tabindex="-1" itemprop="url" data-pjax-state="">Twikoo</a><h1 id="CrawlerTitle" itemprop="name headline">解决网站 URL 加个 index.html 后 Twikoo 评论显示问题</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">MortalCat</span><time itemprop="dateCreated datePublished" datetime="2024-05-26T05:44:00.000Z" title="发表于 2024-05-26 13:44:00">2024-05-26</time><time itemprop="dateCreated datePublished" datetime="2024-11-22T09:37:07.977Z" title="更新于 2024-11-22 17:37:07">2024-11-22</time></header><h2 id="前言"><a href="#前言" class="headerlink" title="前言" data-pjax-state=""></a>前言</h2><p>我在浏览 twikoo 评论时发现有一个评论不知道为什么在后台可以看到，在文章评论区却看不到，跳转后发现来自 posts/261f/index.html 于是便有了这个解决此问题文章</p><blockquote><p>方法参考 <a href="/go?cat=aHR0cHM6Ly9naXRodWIuY29tL3R3aWtvb2pzL3R3aWtvby9pc3N1ZXMvNjA4" rel="external nofollow noopener noreferrer" target="_blank">Twikoo Github issue</a></p></blockquote><h2 id="问题"><a href="#问题" class="headerlink" title="问题" data-pjax-state=""></a>问题</h2><p>使用用 hexo-abbrlink 插件生成的链接格式有两种选择</p><figure class="highlight yaml"><div class="highlight-tools "><i class="anzhiyufont anzhiyu-icon-angle-down expand ${highlightShrinkClass}"></i><div class="code-lang">yaml</div><div class="copy-notice"></div><i class="anzhiyufont anzhiyu-icon-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">posts/:abbrlink.html</span> </span><br><span class="line"><span class="string">或</span></span><br><span class="line"><span class="string">posts/:abbrlink</span></span><br></pre></td></tr></tbody></table></figure><p>但是使用第二种不带 html 结尾的格式会遇到一个问题，它是可以在后面加个 <strong>index.html</strong> 的！</p><figure class="highlight html"><div class="highlight-tools "><i class="anzhiyufont anzhiyu-icon-angle-down expand ${highlightShrinkClass}"></i><div class="code-lang">html</div><div class="copy-notice"></div><i class="anzhiyufont anzhiyu-icon-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://blog.xiowo.net/posts/261f/</span><br><span class="line">https://blog.xiowo.net/posts/261f/index.html</span><br></pre></td></tr></tbody></table></figure><p>这就导致两个链接都能正常指向文章</p><p>而这时问题就来了</p><p><strong>Twikoo</strong> 是以 url 区分页面并获取评论数据的，这就导致一个文章会有两个评论数据而且互不可见，影响挺大的</p><h2 id="解决措施"><a href="#解决措施" class="headerlink" title="解决措施" data-pjax-state=""></a>解决措施</h2><h4 id="更正评论显示位置"><a href="#更正评论显示位置" class="headerlink" title="更正评论显示位置" data-pjax-state=""></a>更正评论显示位置</h4><p>直接修改数据表，或在 Twikoo 管理面板 导出评论 json 数据使用代码编辑器将相关评论中的 <strong>url</strong> 、 <strong>href</strong> 字段中的 index.html 删除，然后重新导入（注意：导入前需要手动删除原 twikoo 所有评论，确保你已做好备份！！！）</p><h4 id="解决Twikoo-评论显示问题"><a href="#解决Twikoo-评论显示问题" class="headerlink" title="解决Twikoo 评论显示问题" data-pjax-state=""></a>解决 Twikoo 评论显示问题</h4><p>在 Twikoo 初始函数的时候添加</p><figure class="highlight js"><div class="highlight-tools "><i class="anzhiyufont anzhiyu-icon-angle-down expand ${highlightShrinkClass}"></i><div class="code-lang">js</div><div class="copy-notice"></div><i class="anzhiyufont anzhiyu-icon-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.<span class="property">pathname</span>.<span class="title function_">replace</span>(<span class="regexp">/index\.html$/</span>, <span class="string">''</span>),</span><br></pre></td></tr></tbody></table></figure><p>Butterfly 主题可以在路径 <strong>themes\butterfly\layout\includes\third-party\comments\twikoo.pug</strong> 进行修改，其他主题找到 Twikoo 相关文件的代码中加入即可</p><figure class="highlight diff"><div class="highlight-tools "><i class="anzhiyufont anzhiyu-icon-angle-down expand ${highlightShrinkClass}"></i><div class="code-lang">diff</div><div class="copy-notice"></div><i class="anzhiyufont anzhiyu-icon-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const init = () => {</span><br><span class="line">      twikoo.init(Object.assign({</span><br><span class="line">        el: '#twikoo-wrap',</span><br><span class="line">        envId: '!{envId}',</span><br><span class="line"><span class="addition">+        path: location.pathname.replace(/index\.html$/, ''),</span></span><br><span class="line">        region: '!{region}',</span><br><span class="line">        onCommentLoaded: () => {</span><br><span class="line">          btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))</span><br><span class="line">        }</span><br><span class="line">      }, !{JSON.stringify(option)}))</span><br></pre></td></tr></tbody></table></figure><p>现在即使再通过 index.html 访问文章，他请求的数据都是不带 index.html 的了，这样他响应的评论数据都是一样的了</p><h2 id="尾声"><a href="#尾声" class="headerlink" title="尾声" data-pjax-state=""></a>尾声</h2><p>至此问题应该算解决了</p><p>不过新站还是建议使用第一个以 <strong>.html</strong> 结尾的链接格式（主要是我不喜欢带这个结尾</p></article>
